# 院线订票系统
数据库期末设计
 
 课程设计报告书

题目：院线订票系统                        

<pre>
学生姓名         吴乐            
指导教师        景建笃           
课程名称    数据库课程设计       
起始日期  2022.6.20-2022.6.24    

数据库课程设计任务书
学生姓名：吴乐            
指导教师：景建笃        
题  目:院线订票系统 
基础要求：
理论：已学习过《Java程序设计》和《数据库原理》课程。掌握基本的面向对象的编程技术，掌握JavaWeb技术；
掌握数据库设计技术和方法，掌握关系数据库的基本理论和方法。
实践要求及环境：熟练使用Eclipse等集成开发环境；掌握关系型数据库管理系统MySQL的使用。
数学与计算机科学学院实验中心提供计算机、软件平台和网络环境。
也可以使用自己的计算机完成课程设计任务。

主要任务: 
1.任务内容 
（1）完成一个院线订票系统的需求分析。需求如下（不限于）： 
  某影片一周内在观影厅的排片；  
  对注册用户或非注册用户的售票，输出影片信息和座位号等； 
  对注册用户每买一张电影票则账户上积与票额相同的分数，当积分超过某一分值时，实行折扣。 
  涉及的主要实体有：客户、观影厅、影片。
（2）在需求分析的基础上完成院线订票系统的数据库概念结构设计； 
（3）完成数据库的逻辑结构设计，所有的模式属于3NF； 
（4）数据库的创建与实施，输入模拟数据； 
（5）使用Java语言完成界面编写，实现需求分析明确的业务逻辑。 
2.完成要求
（1）在数据库课程设计周内完成本课程设计任务；
（2）在指导老师的指导下，本课程设计任务由学生个人单独完成；
（3）课程设计结束时，由指导老师检查学生的设计完成情况，学生进行适当的答辩。
3. 撰写课程设计报告
报告格式严格按附件要求书写。
时间安排：
2022.6.20-2022.6.24


指导教师签名：年    月    日


<b>院线订票系统</b>

<b>1.选题背景</b>

应用角度：随着时代的发展，人们的精神需求日益增加。虽然智能手机、电脑、投影仪已经发展到可以随时看电影，
并且中国几乎人手一部手机，但是很多人喜欢到电影院看电影，比如情侣约会、家庭聚会都喜欢到电影院看电影，
因为毕竟家里或者寝室里看电影的氛围没有电影院的好。为了方便客人，也为了方便管理，电影院需要一套能跟进时代的系统，
无外乎是客人订票，能看到电影名、放映厅号和场次时间等一系列重要的信息，只有打开该系统就能方便地查看，省去了实体票的种种不方便。

技术角度：本系统需要用到Java技术、数据库系统和JavaWeb等技术。Java是一门面向对象的高级语言，不仅吸收了C++语言的各种优点，
还摒弃了C++里难以理解的多继承、指针等概念，因此Java语言具有功能强大和简单易用两个特征。Java语言作为静态面向对象编程语言的代表，
极好地实现了面向对象理论，允许程序员以优雅的思维方式进行复杂的编程. Java具有简单性、面向对象、分布式、健壮性、安全性、
平台独立与可移植性、多线程、动态性等特点 [2]  。Java可以编写桌面应用程序、Web应用程序、分布式系统、和嵌入式系统应用程序等。
数据库技术是信息系统的一个核心技术。是一种计算机辅助管理数据的方法，它研究如何组织和存储数据，如何高效地获取和处理数据。
Java Web，是用Java技术来解决相关web互联网领域的技术栈。

<b>2.方案论证</b>
院线订票系统是方便客户买票看票而设计，本系统能实现用户登录、用户注册、游客查看、查看本周电影、查看座位、购买电影票等功能。种种功能简洁实用。
2.1 目标
为了方便用户和体现简洁实用的思想，应该做到一下几点：
（1）不登陆也能查看本周电影，所以设有游客登录，可以查看本周要播出的电影，但是无法购票。
（2）用户可以方便地查看自己的个人信息以及已经购买了的票。
（3）用户可以查看本周要播放的电影，并购票。
2.3 开发环境
操作系统：Windows10
数据库系统：MySQL server 8
开发工具：Intellij IDEA
2.4 技术可行性研究
（1）在当前的限制条件和要求下，该系统的功能目标可以到达。
（2）利用现有的技术，例如Java、java Web、MySQL等技术，该系统的功能可以实现。
（3）开发人员个数为一，开发人员的数量和质量可以满足该系统的程序开发的所有需要。
（4）在规定的期限内，开发人员可以完成该系统的开发。
2.5 经济可行性
（1）支出
该系统的程序开发成本为零元，时间成本为一个星期，基本投资为一台电脑、一台台灯。
（2）收益
该系统应用后，可以极大提高购票方便程度，可以减少人工成本，具体收益视情况而定，收益大概在零至一亿元人民币之间。

<b>3.设计过程</b>
3.1需求分析
（1）非注册用户也能查看本周电影，但是不能买票。
（2）用户能够查看自己的个人信息。
（3）用户能查看自己已经买了的电影票。
（4）用户要能够查看本周要播放的电影。
（5）用户要能够买票，买票时显示放映厅号、时间等信息，以及显示座位信息，用户自己选座位。
（6）对于已经卖出去的座位不能显示。
（7）用例图，如图3.1所示：
图3.1 用例图
3.2概要设计
3.2.1软件概要设计
（1）系统结构设计，如图3.2所示：
图3.2 系统结构图
（2）程序模块设计，如图3.3所示
图3.3 程序模块图
Dao数据查询层：对接数据库，查询数据，对数据库的基本的增删改查。
Service数据处理层：调用Dao层函数，对Dao层的返回值进行加工。
Servlet表现层：调用Service层函数，接收请求，封装数据，响应数据。
3.2.2 数据库概要设计
该系统使用MySQL server 8作为后台的数据库管理系统。该系统主要涉及客
户、放映厅、电影等实体；所有的模式属于3NF。
（1）E-R图，如图3.4所示：
图3.4 数据库E-R图
（2）关系模式的转换
用户（用户号，用户名，用户密码，用户权限，用户分数）
用户票仓（用户号，放映厅号，日期，场次号，电影院，座位号
电影院（放映厅号）
排片（放映厅号，日期，场次号）
场次（放映厅号，日期，场次号，电影号，场次开始时间，场次结束时间）
电影（电影号，电影名，电影简介，电影分类，价格）
排座（放映厅号，日期，场次号，电影号，座位号，用户号）
（3）3NF分析
	用户表主码为用户号，该主码与其他属性不存在传递依赖，所以该表符合第三范式。
  电影表主码为用户号，该主码与其他属性不存在传递依赖，所以该表符合第三范式。
  电影院表主码为用户号，该主码与其他属性不存在传递依赖，所以该表符合第三范式。
3.3 详细设计
3.3.1软件详细设计
（1）dao数据查询模块，如图3.5所示：
图3.5 dao层方法图
（2）service层数据处理层，如图3.6所示：
图3.6 service层方法图
（3）servlet层表现层，如图3.7所示：
图3.7 servlet层方法图
（4）实体类，如图3.8所示：
图3.8 实体类图
（5）类图，如图3.9所示：
图3.9 类图
3.3.2数据库设计 
图3.10 event表图
图3.11 user表图
图3.12 seat表图
3.3.3 界面设计
本着简洁使用的思想设计界面，使用户觉得信息一目了然，功能明了，不追求过分美观。
（1）	我的信息界面
显示用户各项信息。如图3.5所示：
图3.13 用户信息界面图
（2）	本周电影界面
显示本周所有电影，并对用户显示购买按钮。如图3.14所示:
图3.14 本周电影界面图
3.4 软件实现
（1）订票的流程
第一步：如果是用户，则显示购票按钮，如果是游客，则请游客登录。
第二步：用户购票，显示订单。
第三步：如果购买，则将相应信息添加进数据库，如果取消订单，则返回购票界面。
流程图如图3.15所示：
图3.15 订票流程图
3.5编码
3.4.1 建表语句
（1）user表
create table user
(
    userNum char(20) ,
    userName char(20),
    userPassword char(20),
    userPower char(20),
    userIntegration int,
    primary key(userNum)
);
（2）ticket表
create table ticket
(
    userNum char(20),
    cinemaNum char(20),
    filmDate date,
    eventNum char(20),
    filmNum char(20),
    seatNum char(20)
);
（3）film表
create table film
(
    filmNum char(20),
    filmName char(50),
    filmProfile char(200),
    filmClass char(20),
    filmPrice int,
    primary key(filmNum)
);
（4）cinema表
create table cinema
(
    cinemaNum char(20)，
    primary key(cinemaNum)
);
（5）filmDate表
create table filmDate
(
    cinemaNum char(20),
    filmDate date,
    eventNum char(20)
);
（6）event表
create table event
(
    cinemaNum char(20),
    eventNum char(20),
    filmNum char(20),
    eventBeginTime time,
    eventEndTime time,
    filmDate date
);
（7）seat表
create table seat
(
    eventNum char(20),
    seatNum char(20)
    userNum char(20),
    filmDate date,
    filmNum char(20),
    cinemaNum char(20)
)；

<b>4.设计总结</b>
    使用了一个三层的架构来组成模块，分别是数据查询层、数据处理层、表现层。数据查询层使用JDBC处理SQL语句，
通过这次实验，我能够熟练地使用JDBC包，与MySQL server相结合，完成对数据库的增删改查。在连接数据库时，
我没有每次要处理SQL语句就连一次数据库，而是创建一个工具类，在工具类里面定义连接数据库的一系列方法，
仅对外开放返回Statement对象的静态函数，这样处理SQL语句时方便了很多，也能节省空间。
    这次设计也暴露出很多不足的地方。一是没有使用Cookie，使得网页间的跳转变得很麻烦，每次都需要获取请求数据，
开发变得复杂；二是在设计数据库时没有考虑周全，设计得不够优雅实用，存在表属性重复的问题，造成了极大的资源浪费；
三是HTML网页很丑，没有体现设计的美；四是JavaWeb技术了解不够深入，编写的程序不够简洁，不够美观，没有做到恰到好处；
五是没有参照现成的程序，如果把现成的程序好好阅读一遍，分析一遍，相信能写出比现在更好的程序。

<b>参考文献</b>
[1]张海藩，牟永敏.软件工程导论（第6版）.北京：清华大学出版社，2013
[2]王珊，萨师煊.数据库系统导论（第5版）.北京：高等教育出版社，2014
</pre>
